@page "/login"
@inject HttpClient httpClient
@inject NavigationManager navigationManager

<h3>Login</h3>
<div class="form-group">
    <label for="username">Username</label>
    <input type="text" class="form-control" id="username" @bind="@username" required>
</div>
<div class="form-group">
    <label for="password">Password</label>
    <input type="password" class="form-control" id="password" @bind="@password" required>
</div>
<button type="button" class="btn btn-primary" @onclick="LoginTask">Login</button>

@if (!string.IsNullOrEmpty(errorMessage))
{
    <p class="text-danger">@errorMessage</p>
}

@code {
    private string username;
    private string password;
    private string errorMessage;

    private async Task LoginTask()
    {
        var request = new { Username = username, Password = password };
        var response = await httpClient.PostAsJsonAsync("api/login", request);

        if (response.IsSuccessStatusCode)
        {
            // Redirect to the appropriate page based on the role
            var user = await response.Content.ReadFromJsonAsync<UserInfo>();
            if (user?.Role == "User")
                navigationManager.NavigateTo("/user");
            else if (user?.Role == "Admin")
                navigationManager.NavigateTo("/admin");
            else
                errorMessage = "Invalid role";
        }
        else
        {
            errorMessage = "Invalid username or password";
        }
    }

    private class UserInfo
    {
        public string Role { get; set; }
    }
}
